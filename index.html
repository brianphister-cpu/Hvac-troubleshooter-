<!doctype html>
<html lang="en">
<hea<link rel="manifest" href="/Hvac-troubleshooter-/manifest.json">
<link rel="icon" href="/Hvac-troubleshooter-/icon-192.png">
<meta name="theme-color" content="#0b1522" />d>
  <button id="installBtn" style="display:none;padding:10px 14px;border:0;border-radius:10px;font-weight:800;background:linear-gradient(90deg,#6ea8ff,#4dd0ff);color:#02111a;cursor:pointer">
  Install HVAC Troubleshooter Pro
  </button>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HVAC Troubleshooter Pro</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b1522" />
<link rel="icon" href="icon-192.png">
<style>
  :root{ --bg:#07121a; --panel:#0b1522; --muted:#9aa6b2;
         --low:#1ea7ff; --high:#ff6b4a; --meter:#38d39f; --accent:#6ea8ff; --ink:#e6eef6; }
  html,body{margin:0;height:100%;font-family:Inter,system-ui,Roboto,Arial;background:linear-gradient(180deg,#07121a,#041018);color:var(--ink)}
  .app{max-width:1180px;margin:18px auto;padding:18px}
  header{display:flex;align-items:center;gap:14px}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--low),var(--high));display:flex;align-items:center;justify-content:center;font-weight:900;color:#001018}
  h1{margin:0;font-size:20px}
  p.lead{margin:2px 0 0;color:var(--muted);font-size:13px}
  .main{display:grid;grid-template-columns:1fr 480px;gap:16px;margin-top:18px}
  .panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.05);border-radius:14px;padding:14px}
  .form-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:var(--ink);font-size:15px}
  .section-title{font-size:13px;color:var(--muted);margin:10px 0 8px;font-weight:800;text-transform:uppercase;letter-spacing:.06em}
  .btn{padding:12px;border-radius:10px;border:0;cursor:pointer;font-weight:800}
  .btn.primary{background:linear-gradient(90deg,var(--accent),#4dd0ff);color:#02111a}
  .btn.secondary{background:linear-gradient(90deg,#6b7280,#9aa6b2);color:#02111a}
  .metric-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px}
  .metric{background:rgba(255,255,255,0.05);padding:10px;border-radius:10px;min-width:120px}
  .metric .k{font-size:12px;color:var(--muted)} .metric .v{font-weight:900}
  .cause{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(0,0,0,0.05));margin-top:8px}
  .bar{flex:1;height:10px;background:rgba(255,255,255,0.12);border-radius:6px;overflow:hidden}
  .bar>i{display:block;height:100%;background:linear-gradient(90deg,var(--low),var(--high))}
  .history{max-height:220px;overflow:auto} .hist{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.03);padding:8px;border-radius:8px;margin-top:6px}
  .legend{display:flex;gap:10px;color:var(--muted);font-size:12px}
  @media(max-width:980px){.main{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo"><img src="icon-192.png" alt="HV" style="width:36px;height:36px;border-radius:8px"></div>
    <div>
      <h1>HVAC Troubleshooter — Pro</h1>
      <p class="lead">Clean illustrated cycle • Offline-capable PWA • R410A, R32, R454B, R22</p>
    </div>
  </header>

  <div class="main">
    <div class="panel">
      <div class="section-title">System & Environment</div>
      <div class="form-grid">
        <div>
          <label>Refrigerant</label>
          <select id="refrig">
            <option value="R410A">R-410A</option>
            <option value="R32">R-32</option>
            <option value="R454B">R-454B</option>
            <option value="R22">R-22</option>
          </select>
        </div>
        <div>
          <label>System Type</label>
          <select id="systemType"><option value="txv">TXV (subcool)</option><option value="fixed">Fixed (superheat)</option></select>
        </div>
        <div><label>Indoor DB (°F)</label><input id="indoorDb" type="number" placeholder="75"></div>
        <div><label>Indoor WB (°F)</label><input id="indoorWb" type="number" placeholder="63"></div>
        <div><label>Outdoor DB (°F)</label><input id="outdoorDb" type="number" placeholder="95"></div>
        <div><label>Target Superheat (°F)</label><input id="targetSH" type="number" value="10"></div>
        <div><label>Target Subcool (°F)</label><input id="targetSC" type="number" value="10"></div>
      </div>

      <hr style="margin:12px 0;border:0;border-top:1px solid rgba(255,255,255,0.06)">

      <div class="section-title">Illustrated Refrigerant Cycle</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:center">
        <div id="diagram" aria-label="Refrigerant cycle diagram">
          <svg viewBox="0 0 760 420" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:auto">
            <g id="evap" transform="translate(40,250)">
              <rect x="0" y="0" width="260" height="90" rx="12" fill="rgba(30,167,255,0.08)" stroke="rgba(30,167,255,0.3)"/>
              <text x="130" y="52" text-anchor="middle" fill="#bfe9ff" font-size="14">Evaporator Coil</text>
            </g>
            <path d="M300 295 C 350 295, 360 200, 410 200" stroke="var(--low)" stroke-width="6" fill="none"/>
            <g id="comp" transform="translate(410,150)">
              <rect x="0" y="0" width="100" height="100" rx="16" fill="rgba(255,255,255,0.05)" stroke="rgba(255,255,255,0.18)"/>
              <text x="50" y="58" text-anchor="middle" fill="#ffd8c8" font-size="14">Compressor</text>
            </g>
            <path d="M510 200 C 560 200, 580 150, 620 150" stroke="var(--high)" stroke-width="6" fill="none"/>
            <g id="cond" transform="translate(620,90)">
              <rect x="0" y="0" width="100" height="120" rx="12" fill="rgba(255,107,74,0.08)" stroke="rgba(255,107,74,0.3)"/>
              <text x="50" y="66" text-anchor="middle" fill="#ffd8c8" font-size="14">Condenser</text>
            </g>
            <path d="M620 210 C 560 210, 520 320, 470 320" stroke="var(--high)" stroke-width="6" fill="none"/>
            <g id="meter" transform="translate(430,300)">
              <rect x="0" y="0" width="80" height="48" rx="10" fill="rgba(56,211,159,0.10)" stroke="rgba(56,211,159,0.3)"/>
              <text x="40" y="30" text-anchor="middle" fill="#c9ffea" font-size="13">Meter</text>
            </g>
            <path d="M430 320 C 360 320, 340 295, 300 295" stroke="var(--low)" stroke-width="6" fill="none"/>
          </svg>
          <div class="legend" style="margin-top:6px">
            <span>Low side</span><span style="width:12px;height:12px;background:var(--low);display:inline-block;border-radius:3px"></span>
            <span style="margin-left:8px">High side</span><span style="width:12px;height:12px;background:var(--high);display:inline-block;border-radius:3px"></span>
            <span style="margin-left:8px">Meter</span><span style="width:12px;height:12px;background:var(--meter);display:inline-block;border-radius:3px"></span>
          </div>
        </div>

        <div>
          <div class="section-title">Evaporator</div>
          <div class="form-grid">
            <div><label>Suction Pressure (psig)</label><input id="suctionP" type="number" placeholder="118"></div>
            <div><label>Suction Line Temp (°F)</label><input id="suctionT" type="number" placeholder="52"></div>
          </div>

          <div class="section-title">Condenser</div>
          <div class="form-grid">
            <div><label>Liquid Pressure (psig)</label><input id="liquidP" type="number" placeholder="380"></div>
            <div><label>Liquid Line Temp (°F)</label><input id="liquidT" type="number" placeholder="95"></div>
          </div>

          <div class="section-title">Optional — Air Temps</div>
          <div class="form-grid">
            <div><label>Supply Air Temp (°F) — SAT</label><input id="supplyT" type="number" placeholder="optional"></div>
            <div><label>Return Air Temp (°F) — RAT</label><input id="returnT" type="number" placeholder="optional"></div>
          </div>

          <div style="display:flex;gap:8px;margin-top:12px">
            <button class="btn primary" id="diagBtn">Diagnose</button>
            <button class="btn secondary" id="saveBtn">Save Reading</button>
          </div>
        </div>
      </div>
    </div>

    <aside class="panel">
      <div class="section-title">Diagnosis</div>
      <div class="panel" style="padding:12px">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <div>
            <div style="font-size:13px;color:var(--muted)">Primary Likely Fault</div>
            <div id="primaryFault" style="font-size:18px;font-weight:900;margin-top:4px">—</div>
          </div>
          <div style="text-align:right">
            <div style="font-size:13px;color:var(--muted)">Confidence</div>
            <div id="confPct" style="font-size:20px;font-weight:900;color:var(--accent)">—%</div>
          </div>
        </div>
        <div class="metric-row">
          <div class="metric"><div class="k">Evap Sat</div><div class="v" id="evapSat">— °F</div></div>
          <div class="metric"><div class="k">Cond Sat</div><div class="v" id="condSat">— °F</div></div>
          <div class="metric"><div class="k">Superheat</div><div class="v" id="superheat">— °F</div></div>
          <div class="metric"><div class="k">Subcool</div><div class="v" id="subcool">— °F</div></div>
          <div class="metric"><div class="k">ΔT (RAT−SAT)</div><div class="v" id="deltat">— °F</div></div>
        </div>
        <div style="margin-top:10px">
          <div style="font-size:13px;color:var(--muted)">Possible Causes (ranked)</div>
          <div id="causesList" style="margin-top:6px"></div>
        </div>
        <div style="margin-top:10px;font-size:13px;color:var(--muted)"><strong>Recommended Next Steps</strong>
          <ul id="nextSteps" style="margin-top:6px"></ul>
        </div>
      </div>

      <div class="section-title" style="margin-top:10px">History</div>
      <div class="panel" style="padding:12px">
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-bottom:6px">
          <button class="btn secondary" id="exportHist">Export History CSV</button>
          <button class="btn secondary" id="clearHist" style="background:linear-gradient(90deg,#ff7b7b,#ffb3b3)">Clear</button>
        </div>
        <div class="history" id="historyList">No saved readings.</div>
      </div>
    </aside>
  </div>

  <footer style="text-align:center;color:var(--muted);font-size:13px;margin-top:12px">Install from browser menu → Add to Home Screen. Works offline after first load. Verify with instruments & OEM data.</footer>
</div>

<script>
const DEFAULT_PT = {
  R410A:[{t:30,p:99},{t:35,p:109},{t:40,p:118},{t:45,p:130},{t:50,p:143},{t:55,p:156},{t:60,p:170},{t:65,p:185},{t:70,p:201},{t:75,p:218},{t:80,p:236},{t:85,p:277},{t:90,p:299},{t:95,p:321},{t:100,p:344},{t:105,p:368},{t:110,p:393},{t:115,p:418},{t:120,p:444},{t:125,p:471},{t:130,p:499}],
  R32:[{t:30,p:71},{t:35,p:80},{t:40,p:90},{t:45,p:101},{t:50,p:112},{t:55,p:124},{t:60,p:137},{t:65,p:150},{t:70,p:164},{t:75,p:179},{t:80,p:195},{t:85,p:211},{t:90,p:228}],
  R454B:[{t:30,p:82},{t:35,p:91},{t:40,p:100},{t:45,p:110},{t:50,p:121},{t:55,p:132},{t:60,p:144},{t:65,p:156},{t:70,p:169},{t:75,p:182},{t:80,p:196},{t:85,p:210},{t:90,p:225}],
  R22:[{t:30,p:78},{t:35,p:89},{t:40,p:102},{t:45,p:115},{t:50,p:129},{t:55,p:145},{t:60,p:161},{t:65,p:179},{t:70,p:198},{t:75,p:219},{t:80,p:242}]
};
let PT = JSON.parse(JSON.stringify(DEFAULT_PT));
function toNum(v){ const n=Number(v); return isNaN(n)?null:n; }
function round1(n){ return n===null?null:Math.round(n*10)/10; }
function pressureToSatTemp(refrig, psig){
  const table = PT[refrig]; if(!table || psig===null) return null;
  if(psig <= table[0].p) return table[0].t; if(psig >= table[table.length-1].p) return table[table.length-1].t;
  for(let i=0;i<table.length-1;i++){ const a=table[i], b=table[i+1];
    if(psig >= a.p && psig <= b.p){ const f=(psig-a.p)/(b.p-a.p); return a.t + f*(b.t-a.t); } }
  return null;
}

function diagnoseAll(d){
  const evapSat = pressureToSatTemp(d.refrig, d.suctionP);
  const condSat = pressureToSatTemp(d.refrig, d.liquidP);
  const superheat = (d.suctionT!=null && evapSat!=null)? d.suctionT - evapSat : null;
  const subcool  = (d.liquidT!=null && condSat!=null)?  condSat - d.liquidT : null;
  const deltaT   = (d.supplyT!=null && d.returnT!=null)? d.returnT - d.supplyT : null;

  let causes = {'Undercharge (low refrigerant)':10,'Overcharge (too much refrigerant)':6,'Restriction — metering device / drier':6,'Low airflow across evaporator':6,'Non-condensables (air in system)':4,'Compressor mechanical issue (valves/leak)':4};
  function add(k,pts){ if(causes[k]!==undefined) causes[k]+=pts; }

  if(superheat!=null && d.targetSH!=null){
    const ds = superheat - d.targetSH;
    if(ds >= 8){ add('Undercharge (low refrigerant)',18); add('Low airflow across evaporator',8); add('Restriction — metering device / drier',6); }
    else if(ds <= -6){ add('Overcharge (too much refrigerant)',18); add('Restriction — metering device / drier',4); }
    else if(Math.abs(ds) >= 4){ add(ds>0?'Undercharge (low refrigerant)':'Overcharge (too much refrigerant)',6); }
  }
  if(subcool!=null && d.targetSC!=null){
    const dc = subcool - d.targetSC;
    if(dc >= 8){ add('Overcharge (too much refrigerant)',16); add('Restriction — metering device / drier',8); }
    else if(dc <= -4){ add('Undercharge (low refrigerant)',14); }
  }
  if(d.suctionP!=null && d.liquidP!=null){
    if(d.suctionP < 105 && d.liquidP < 320) add('Undercharge (low refrigerant)',14);
    if(d.suctionP < 105 && d.liquidP > 380){ add('Low airflow across evaporator',12); add('Non-condensables (air in system)',10); }
    if(d.suctionP > 160 && d.liquidP < 330) add('Compressor mechanical issue (valves/leak)',18);
    if(d.suctionP > 160 && d.liquidP > 480){ add('Overcharge (too much refrigerant)',12); add('Non-condensables (air in system)',10); }
  }
  if(deltaT!=null){ if(deltaT < 12) add('Low airflow across evaporator',18); else if(deltaT > 28) add('Low airflow across evaporator',8); }
  if(d.outdoorDb!=null && d.liquidP!=null){ if(d.outdoorDb > 95 && d.liquidP > 480) add('Non-condensables (air in system)',8); }

  let ranked = Object.keys(causes).map(k=>({cause:k,score:causes[k]})).filter(x=>x.score>0).sort((a,b)=>b.score-a.score);
  const total = ranked.reduce((s,i)=>s+i.score,0)||1; ranked.forEach(a=>a.pct=Math.round((a.score/total)*100));
  const primary = ranked[0] ? ranked[0] : {cause:'Insufficient data',pct:0};

  let steps = [];
  if(primary.cause.includes('Undercharge')) steps.push('Perform leak check; charge to manufacturer spec using subcooling/superheat targets.');
  if(primary.cause.includes('Overcharge')) steps.push('Recover to target subcool; verify after stabilization and re-check airflow.');
  if(primary.cause.includes('Restriction')) steps.push('Check liquid line drier and TXV/orifice screens; replace any restricted components.');
  if(primary.cause.includes('Low airflow')) steps.push('Verify filter, blower amps, coil cleanliness, and duct dampers; measure CFM if possible.');
  if(primary.cause.includes('Non-condensables')) steps.push('Deep recovery & vacuum; recharge by weight. Watch head pressure behavior.');
  if(primary.cause.includes('Compressor')) steps.push('Check amp draw and consider valve/leak-down tests; verify compression ratio.');

  return {details:{evapSat:round1(evapSat),condSat:round1(condSat),superheat:superheat==null?null:round1(superheat),subcool:subcool==null?null:round1(subcool),deltaT:deltaT==null?null:round1(deltaT)}, ranked, primary, steps};
}

function $(id){return document.getElementById(id);}
function readInputs(){ return {
  refrig: $('refrig').value, systemType: $('systemType').value,
  indoorDb: toNum($('indoorDb').value), indoorWb: toNum($('indoorWb').value), outdoorDb: toNum($('outdoorDb').value),
  targetSH: toNum($('targetSH').value) ?? 10, targetSC: toNum($('targetSC').value) ?? 10,
  suctionP: toNum($('suctionP').value), suctionT: toNum($('suctionT').value),
  liquidP: toNum($('liquidP').value), liquidT: toNum($('liquidT').value),
  supplyT: toNum($('supplyT').value), returnT: toNum($('returnT').value)
}; }
function renderResults(r){
  $('primaryFault').textContent = r.primary.cause; $('confPct').textContent = (r.primary.pct||0)+'%';
  $('evapSat').textContent = r.details.evapSat==null?'—':r.details.evapSat+' °F';
  $('condSat').textContent = r.details.condSat==null?'—':r.details.condSat+' °F';
  $('superheat').textContent = r.details.superheat==null?'—':r.details.superheat+' °F';
  $('subcool').textContent = r.details.subcool==null?'—':r.details.subcool+' °F';
  $('deltat').textContent = r.details.deltaT==null?'—':r.details.deltaT+' °F';
  const list=$('causesList'); list.innerHTML='';
  r.ranked.forEach(it=>{ const row=document.createElement('div'); row.className='cause'; row.innerHTML=`<div>${it.cause}</div><div class="bar"><i style="width:${it.pct}%"></i></div><div style="min-width:48px;text-align:right">${it.pct}%</div>`; list.appendChild(row); });
  const ns=$('nextSteps'); ns.innerHTML=''; r.steps.forEach(s=>{ const li=document.createElement('li'); li.textContent=s; ns.appendChild(li); });
}
const HIST_KEY='hvac_hist_v1';
function loadHist(){ try{return JSON.parse(localStorage.getItem(HIST_KEY)||'[]');}catch(e){return [];} }
function saveHist(a){ localStorage.setItem(HIST_KEY, JSON.stringify(a)); }
function addHist(entry){ const a=loadHist(); a.unshift(entry); if(a.length>200) a.pop(); saveHist(a); renderHist(); }
function renderHist(){ const list=$('historyList'); const a=loadHist(); if(a.length===0){list.textContent='No saved readings.'; return;} list.innerHTML=''; a.forEach((h,i)=>{ const d=document.createElement('div'); d.className='hist'; d.innerHTML=`<div><strong>${h.refrig}</strong> · ${h.time}<br><span style="color:var(--muted);font-size:12px">SP:${h.suctionP}psi ST:${h.suctionT}°F · LP:${h.liquidP}psi LT:${h.liquidT}°F · ΔT:${h.deltaT??'—'}°F</span></div>`; const del=document.createElement('button'); del.textContent='Del'; del.className='btn'; del.style.padding='6px'; del.style.borderRadius='8px'; del.style.background='linear-gradient(90deg,#ff7b7b,#ffb3b3)'; del.style.color='#02111a'; del.onclick=()=>{const x=loadHist(); x.splice(i,1); saveHist(x); renderHist();}; d.appendChild(del); list.appendChild(d); }); }
document.getElementById('diagBtn').addEventListener('click', ()=>{ const d=readInputs(); if(d.suctionP==null||d.liquidP==null||d.suctionT==null||d.liquidT==null){ alert('Required: suction pressure, liquid pressure, suction line temp, and liquid line temp. SAT/RAT optional.'); return; } const r=diagnoseAll(d); renderResults(r); });
document.getElementById('saveBtn').addEventListener('click', ()=>{ const d=readInputs(); const now=new Date(); const deltaT=(d.supplyT!=null&&d.returnT!=null)?(d.returnT-d.supplyT):null; addHist({time:now.toLocaleString(), refrig:d.refrig, suctionP:d.suctionP, suctionT:d.suctionT, liquidP:d.liquidP, liquidT:d.liquidT, deltaT}); alert('Saved to history.'); });
document.getElementById('exportHist').addEventListener('click', ()=>{ const rows=loadHist(); if(rows.length===0){alert('No history to export.'); return;} const cols=['time','refrig','suctionP','suctionT','liquidP','liquidT','deltaT']; const csv=[cols.join(',')].concat(rows.map(r=>cols.map(c=>r[c]??'').join(','))).join('\n'); const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='hvac_history.csv'; a.click(); });
document.getElementById('clearHist').addEventListener('click', ()=>{ if(confirm('Clear all history?')){ saveHist([]); renderHist(); } });
function highlight(comp){ ['evap','comp','cond','meter'].forEach(id=>{ const el=document.getElementById(id); if(!el) return; el.style.filter=''; el.style.transform=''; }); if(!comp) return; const el=document.getElementById(comp); if(el){ el.style.filter='drop-shadow(0 8px 24px rgba(255,255,255,0.16))'; el.style.transform='translateY(-3px)'; } }
['suctionP','suctionT'].forEach(id=>{ document.getElementById(id).addEventListener('focus',()=>highlight('evap')); });
['liquidP','liquidT'].forEach(id=>{ document.getElementById(id).addEventListener('focus',()=>highlight('cond')); });
['targetSH','targetSC'].forEach(id=>{ document.getElementById(id).addEventListener('focus',()=>highlight('meter')); });
['indoorDb','indoorWb','outdoorDb'].forEach(id=>{ document.getElementById(id).addEventListener('focus',()=>highlight('comp')); });
if('serviceWorker' in navigator){ navigator.serviceWorker.register('./service-worker.js').catch(()=>{}); }
renderHist();
  <script>
let deferredPrompt;
const installBtn = document.getElementById('installBtn');

// Show the button when the browser says the app is installable
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();           // stop the automatic mini-infobar
  deferredPrompt = e;           // stash the event for later
  installBtn.style.display = 'inline-block';
});

// On click, trigger the install prompt
installBtn.addEventListener('click', async () => {
  if (!deferredPrompt) return;
  installBtn.disabled = true;
  deferredPrompt.prompt();
  const { outcome } = await deferredPrompt.userChoice;
  // outcome is 'accepted' or 'dismissed'
  deferredPrompt = null;
  installBtn.style.display = 'none';
});

// Hide button if already installed
function isStandalone() {
  return window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
}
if (isStandalone()) installBtn.style.display = 'none';

// When the app gets installed
window.addEventListener('appinstalled', () => {
  installBtn.style.display = 'none';
});
  <script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/Hvac-troubleshooter-/service-worker.js');
}
</script>
</script>
</script>
</body>
</html>
